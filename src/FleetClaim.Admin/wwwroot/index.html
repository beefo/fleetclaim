<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetClaim Admin</title>
    <link rel="stylesheet" href="styles.css?v=30">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ›¡ï¸ FleetClaim Admin</h1>
            <div id="auth-status" class="auth-status">Not authenticated</div>
        </header>

        <div id="auth-form" class="auth-form">
            <input type="password" id="api-key" placeholder="Enter Admin API Key">
            <button onclick="authenticate()">Connect</button>
        </div>

        <main id="dashboard" class="dashboard hidden">
            <section class="overview-cards">
                <div class="card">
                    <h3>Databases</h3>
                    <div id="db-count" class="big-number">-</div>
                </div>
                <div class="card">
                    <h3>Total Requests</h3>
                    <div id="request-count" class="big-number">-</div>
                </div>
                <div class="card">
                    <h3>Pending</h3>
                    <div id="pending-count" class="big-number warning">-</div>
                </div>
                <div class="card">
                    <h3>Reports Generated</h3>
                    <div id="report-count" class="big-number success">-</div>
                </div>
            </section>

            <section class="databases-section">
                <div class="section-header">
                    <h2>ğŸ“Š Databases</h2>
                    <button onclick="var m=document.getElementById('onboard-modal'); m.style.display='flex'; m.classList.remove('hidden');" class="btn-primary">â• Add Database</button>
                </div>
                <div id="databases-list" class="databases-list">
                    Loading...
                </div>
            </section>
            <section class="requests-section">
                <h2>ğŸ“‹ Recent Requests</h2>
                <select id="db-selector" onchange="loadRequests()">
                    <option value="">Select database...</option>
                </select>
                <div id="requests-list" class="requests-list">
                    Select a database to view requests
                </div>
            </section>

            <section class="jobs-section">
                <h2>âš™ï¸ Recent Worker Executions</h2>
                <button onclick="loadJobs()" class="refresh-btn">ğŸ”„ Refresh</button>
                <div id="jobs-list" class="jobs-list">
                    Loading...
                </div>
            </section>

            <section class="logs-section">
                <h2>ğŸ“ Recent Logs</h2>
                <button onclick="loadLogs()" class="refresh-btn">ğŸ”„ Refresh</button>
                <div id="logs-list" class="logs-list">
                    Loading...
                </div>
            </section>
        </main>

        <footer>
            <p>FleetClaim Admin Portal â€¢ <span id="last-updated">-</span></p>
        </footer>
    </div>

    <!-- Onboard Database Modal (outside container for proper z-index) -->
    <div id="onboard-modal" class="modal hidden" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:1000;" onclick="if(event.target===this)this.style.display='none';">
        <div class="modal-content" style="background:#1e293b;border-radius:12px;padding:24px;width:100%;max-width:480px;position:relative;">
            <button type="button" onclick="document.getElementById('onboard-modal').style.display='none';" style="position:absolute;top:12px;right:12px;background:none;border:none;color:#94a3b8;font-size:24px;cursor:pointer;line-height:1;">&times;</button>
            <h3 style="margin:0 0 20px 0;color:#f1f5f9;">Add New Database</h3>
            <form id="onboard-form" onsubmit="onboardDatabase(event)">
                <div class="form-group">
                    <label for="db-name">Database Name</label>
                    <input type="text" id="db-name" placeholder="e.g., company_fleet" required>
                </div>
                <div class="form-group">
                    <label for="db-server">Server</label>
                    <input type="text" id="db-server" value="my.geotab.com" required>
                </div>
                <div class="form-group">
                    <label for="db-username">Username (API User)</label>
                    <input type="text" id="db-username" placeholder="e.g., fleetclaim_svc@company.com" required>
                </div>
                <div class="form-group">
                    <label for="db-password">Password</label>
                    <input type="password" id="db-password" required>
                </div>
                <div class="modal-actions">
                    <button type="button" id="cancel-btn" class="btn-secondary">Cancel</button>
                    <button type="submit" class="btn-primary" id="onboard-submit">Add Database</button>
                </div>
            </form>
            <div id="onboard-result" class="hidden"></div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
